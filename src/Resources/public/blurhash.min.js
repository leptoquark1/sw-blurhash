window.Blurhash={_internal:{utils:{sRGBToLinear:function(e){var t=e/255;return t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)},linearTosRGB:function(e){var t=Math.max(0,Math.min(1,e));return t<=.0031308?Math.round(12.92*t*255+.5):Math.round(255*(1.055*Math.pow(t,1/2.4)-.055)+.5)},sign:function(e){return e<0?-1:1},signPow:function(e,t){return Blurhash._internal.utils.sign(e)*Math.pow(Math.abs(e),t)}},base83:{digitCharacters:["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],decode83:function(e){for(var t=0,r=0;r<e.length;r++){var n=e[r];t=83*t+Blurhash._internal.base83.digitCharacters.indexOf(n)}return t}},decode:{decodeDC:function(e){var t=e>>16,r=e>>8&255,n=255&e;return[Blurhash._internal.utils.sRGBToLinear(t),Blurhash._internal.utils.sRGBToLinear(r),Blurhash._internal.utils.sRGBToLinear(n)]},decodeAC:function(e,t){var r=Math.floor(e/361),n=Math.floor(e/19)%19,a=e%19;return[Blurhash._internal.utils.signPow((r-9)/9,2)*t,Blurhash._internal.utils.signPow((n-9)/9,2)*t,Blurhash._internal.utils.signPow((a-9)/9,2)*t]},validateBlurhash:function(e){if(!e||e.length<6)throw new Error("The blurhash string must be at least 6 characters");var t=Blurhash._internal.base83.decode83(e[0]),r=Math.floor(t/9)+1,n=t%9+1;if(e.length!==4+2*n*r)throw new Error("blurhash length mismatch: was ".concat(e.length," but it should be ").concat(4+2*n*r))}}},isValid:function(e){try{Blurhash._internal.decode.validateBlurhash(e)}catch(e){return{result:!1,errorReason:e.message}}return{result:!0}},decodeBlurhash:function(e,t,r,n){Blurhash._internal.decode.validateBlurhash(e);n|=1;for(var a=Blurhash._internal.base83.decode83(e[0]),i=Math.floor(a/9)+1,o=a%9+1,l=(Blurhash._internal.base83.decode83(e[1])+1)/166,h=new Array(o*i),s=0;s<h.length;s++){var u;if(0===s){u=Blurhash._internal.base83.decode83(e.substring(2,6));h[s]=Blurhash._internal.decode.decodeDC(u)}else{u=Blurhash._internal.base83.decode83(e.substring(4+2*s,6+2*s));h[s]=Blurhash._internal.decode.decodeAC(u,l*n)}}for(var c=4*t,d=new Uint8ClampedArray(c*r),g=0;g<r;g++)for(var b=0;b<t;b++){for(var B=0,m=0,f=0,v=0;v<i;v++)for(var w=0;w<o;w++){var p=Math.cos(Math.PI*b*w/t)*Math.cos(Math.PI*g*v/r),_=h[w+v*o];B+=_[0]*p;m+=_[1]*p;f+=_[2]*p}var U=Blurhash._internal.utils.linearTosRGB(B),M=Blurhash._internal.utils.linearTosRGB(m),N=Blurhash._internal.utils.linearTosRGB(f);d[4*b+0+g*c]=U;d[4*b+1+g*c]=M;d[4*b+2+g*c]=N;d[4*b+3+g*c]=255}return d},pixelsToCanvas:function(e,t,r){const n=document.createElement("canvas");n.width=t;n.height=r;const a=n.getContext("2d"),i=new ImageData(e,t,r);a.putImageData(i,0,0);return n},pixelsToBase64:function(e,t,r,n,a){return Blurhash.pixelsToCanvas(e,t,r).toDataURL(a||"image/jpeg",n||1)},onPixelsToBlobSrc:function(e,t,r,n,a,i){Blurhash.pixelsToCanvas(t,r,n).toBlob((function(t){var r=document.createElement("img"),n=URL.createObjectURL(t);r.onload=function(){URL.revokeObjectURL(n)};e(n)}),i||"image/jpeg",a||1)}};window.ecbUtils={getViewport:function(){return{height:window.innerHeight||document.documentElement.clientHeight,width:window.innerWidth||document.documentElement.clientWidth}},getNodeAttribute:function(e,t){var r=e.attributes.getNamedItem(t);return r?r.value:null},decodeHashForNode:function(e,t,r){t=t||e.node;setTimeout((function(){if(!1===t.complete){var n=Blurhash.decodeBlurhash(e.hash,e.width,e.height);Blurhash.onPixelsToBlobSrc((function(e){!0===t.complete?r(null):r(e)}),n,e.width,e.height)}else r(null)}),200)},extractNode:function(e){var t=ecbUtils.getNodeAttribute(e,"data-blurhash");if(!t||ecbUtils.isImageCached(e.src))return null;var r=Number(ecbUtils.getNodeAttribute(e,"data-ow")),n=Number(ecbUtils.getNodeAttribute(e,"data-oh")),a=ecbUtils.getNodeAttribute(e,"srcset")||ecbUtils.getNodeAttribute(e,"data-srcset");return isNaN(r)||0===r||isNaN(n)||0===n?null:{hash:t,width:r,height:n,srcset:a,node:e}},isAncestorsVisible:function(e){var t=!0;do{var r=getComputedStyle(e);t=!(0===Number(r.opacity)||"none"===r.display);e=e.parentElement}while(null!==e&&!0===t);return t},isImageCached:function(e){var t=new Image;t.src=e;var r=t.complete;t.src="";return r},isInViewport:function(e){var t=e.getBoundingClientRect(),r=ecbUtils.getViewport();return t.top>0&&t.bottom>0||t.bottom-r.height>0&&t.top<0||-1*(t.top-r.height)>0&&t.bottom-r.height>0||-1*(t.bottom-r.height)>0&&t.top+r.height<0},placeholders:{},placeholderBase64:function(e,t){var r=e+"_"+t;if(ecbUtils.placeholders[r])return ecbUtils.placeholders[r];var n=document.createElement("canvas");n.width=e;n.height=t;return ecbUtils.placeholders[r]=n.toDataURL("image/webp",1)}};
