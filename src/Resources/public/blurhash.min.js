window.Blurhash={_internal:{utils:{D:3294.6,E:269.025,PI:Math.PI,PI2:2*Math.PI,sRGBToLinear:function(t){return t>10.31475?Math.pow(t/Blurhash._internal.utils.E+.052132,2.4):t/Blurhash._internal.utils.D},linearTosRGB:function(t){return~~(t>1227e-8?Blurhash._internal.utils.E*Math.pow(t,.416666)-13.025:t*Blurhash._internal.utils.D+1)},sign:function(t){return t<0?-1:1},signPow:function(t,e){return Blurhash._internal.utils.sign(t)*Math.pow(Math.abs(t),e)},signSqr:function(t){return(t<0?-1:1)*t*t},fastCos:function(t){t+=Blurhash._internal.utils.PI/2;for(;t>Blurhash._internal.utils.PI;)t-=Blurhash._internal.utils.PI2;var e=1.27323954*t-.405284735*Blurhash._internal.utils.signSqr(t);return.225*(Blurhash._internal.utils.signSqr(e)-e)+e}},base83:{digit:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz#$%*+,-.:;=?@[]^_{|}~",decode83:function(t,e,n){for(var r=0;e<n;){r*=83;r+=Blurhash._internal.base83.digit.indexOf(t[e++])}return r}}},decodeBlurhash:function(t,e,n,r){var i=Blurhash._internal.base83.decode83(t,0,1),a=i%9+1,l=1+~~(i/9),s=a*l,u=(Blurhash._internal.base83.decode83(t,1,2)+1)/13446*(1|r),o=new Float64Array(3*s),h=Blurhash._internal.base83.decode83(t,2,6);o[0]=Blurhash._internal.utils.sRGBToLinear(h>>16);o[1]=Blurhash._internal.utils.sRGBToLinear(h>>8&255);o[2]=Blurhash._internal.utils.sRGBToLinear(255&h);var c=0,d=0,B=0,g=0,b=0,f=0,m=0,_=0,w=0,p=0,v=0,N=0,I=0;for(c=1;c<s;c++){h=Blurhash._internal.base83.decode83(t,4+2*c,6+2*c);o[3*c]=Blurhash._internal.utils.signSqr(~~(h/361)-9)*u;o[3*c+1]=Blurhash._internal.utils.signSqr(~~(h/19)%19-9)*u;o[3*c+2]=Blurhash._internal.utils.signSqr(h%19-9)*u}var T=4*e,R=new Uint8ClampedArray(T*n);for(g=0;g<n;g++){N=Blurhash._internal.utils.PI*g/n;for(B=0;B<e;B++){b=0;f=0;m=0;I=Blurhash._internal.utils.PI*B/e;for(d=0;d<l;d++){w=Blurhash._internal.utils.fastCos(N*d);for(c=0;c<a;c++){_=Blurhash._internal.utils.fastCos(I*c)*w;b+=o[p=3*(c+d*a)]*_;f+=o[p+1]*_;m+=o[p+2]*_}}R[v=4*B+g*T]=Blurhash._internal.utils.linearTosRGB(b);R[v+1]=Blurhash._internal.utils.linearTosRGB(f);R[v+2]=Blurhash._internal.utils.linearTosRGB(m);R[v+3]=255}}return R},pixelsToCanvas:function(t,e,n){var r=document.createElement("canvas");r.width=e;r.height=n;var i=r.getContext("2d"),a=new ImageData(t,e,n);i.putImageData(a,0,0);return r},pixelsToBase64:function(t,e,n,r,i){return Blurhash.pixelsToCanvas(t,e,n).toDataURL(i||"image/jpeg",r||1)},onPixelsToBlobSrc:function(t,e,n,r,i,a){Blurhash.pixelsToCanvas(e,n,r).toBlob((function(e){var n=document.createElement("img"),r=URL.createObjectURL(e);n.onload=function(){URL.revokeObjectURL(r)};t(r)}),a||"image/jpeg",i||1)}};window.ecbUtils={nestedCallback:function(t,e){return function(){t.call(this);e.call(this)}},getViewport:function(){return{height:window.innerHeight||document.documentElement.clientHeight,width:window.innerWidth||document.documentElement.clientWidth}},getNodeAttribute:function(t,e){var n=t.attributes.getNamedItem(e);return n?n.value:null},decodeHashForNode:function(t,e,n){e=e||t.node;setTimeout((function(){if(!1===e.complete){var r=Blurhash.decodeBlurhash(t.hash,t.width,t.height);Blurhash.onPixelsToBlobSrc((function(t){!0===e.complete?n(null):n(t)}),r,t.width,t.height)}else n(null)}),200)},extractNode:function(t){var e=ecbUtils.getNodeAttribute(t,"data-blurhash"),n=ecbUtils.getNodeAttribute(t,"data-src");if(!e)return null;var r=Number(ecbUtils.getNodeAttribute(t,"data-ow")),i=Number(ecbUtils.getNodeAttribute(t,"data-oh")),a=ecbUtils.getNodeAttribute(t,"srcset")||ecbUtils.getNodeAttribute(t,"data-srcset");if(isNaN(r)||0===r||isNaN(i)||0===i){n&&(t.src=n);return null}return{hash:e,width:r,height:i,srcset:a,node:t}},isAncestorsVisible:function(t){var e=!0;do{var n=getComputedStyle(t);e=!(0===Number(n.opacity)||"none"===n.display);t=t.parentElement}while(null!==t&&!0===e);return e},isImageCached:function(t){var e=new Image;e.src=t;var n=e.complete;e.src="";return n},isInViewport:function(t){var e=t.getBoundingClientRect(),n=ecbUtils.getViewport();return e.top>0&&e.bottom>0||e.bottom-n.height>0&&e.top<0||-1*(e.top-n.height)>0&&e.bottom-n.height>0||-1*(e.bottom-n.height)>0&&e.top+n.height<0}};
