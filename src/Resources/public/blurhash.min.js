window.Blurhash={_internal:{utils:{sRGBToLinear:function(a){var e=a/255;return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)},linearTosRGB:function(a){var e=Math.max(0,Math.min(1,a));return e<=.0031308?Math.round(12.92*e*255+.5):Math.round(255*(1.055*Math.pow(e,1/2.4)-.055)+.5)},sign:function(a){return a<0?-1:1},signPow:function(a,e){return Blurhash._internal.utils.sign(a)*Math.pow(Math.abs(a),e)}},base83:{digitCharacters:["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","#","$","%","*","+",",","-",".",":",";","=","?","@","[","]","^","_","{","|","}","~"],decode83:function(a){for(var e=0,r=0;r<a.length;r++){var n=a[r];e=83*e+Blurhash._internal.base83.digitCharacters.indexOf(n)}return e}},decode:{decodeDC:function(a){var e=a>>16,r=a>>8&255,n=255&a;return[Blurhash._internal.utils.sRGBToLinear(e),Blurhash._internal.utils.sRGBToLinear(r),Blurhash._internal.utils.sRGBToLinear(n)]},decodeAC:function(a,e){var r=Math.floor(a/361),n=Math.floor(a/19)%19,t=a%19;return[Blurhash._internal.utils.signPow((r-9)/9,2)*e,Blurhash._internal.utils.signPow((n-9)/9,2)*e,Blurhash._internal.utils.signPow((t-9)/9,2)*e]},validateBlurhash:function(a){if(!a||a.length<6)throw new Error("The blurhash string must be at least 6 characters");var e=Blurhash._internal.base83.decode83(a[0]),r=Math.floor(e/9)+1,n=e%9+1;if(a.length!==4+2*n*r)throw new Error("blurhash length mismatch: was ".concat(a.length," but it should be ").concat(4+2*n*r))}}},isValid:function(a){try{Blurhash._internal.decode.validateBlurhash(a)}catch(a){return{result:!1,errorReason:a.message}}return{result:!0}},decodeBlurhash:function(a,e,r,n){Blurhash._internal.decode.validateBlurhash(a);n|=1;for(var t=Blurhash._internal.base83.decode83(a[0]),s=Math.floor(t/9)+1,l=t%9+1,h=(Blurhash._internal.base83.decode83(a[1])+1)/166,i=new Array(l*s),o=0;o<i.length;o++){var u;if(0===o){u=Blurhash._internal.base83.decode83(a.substring(2,6));i[o]=Blurhash._internal.decode.decodeDC(u)}else{u=Blurhash._internal.base83.decode83(a.substring(4+2*o,6+2*o));i[o]=Blurhash._internal.decode.decodeAC(u,h*n)}}for(var c=4*e,d=new Uint8ClampedArray(c*r),B=0;B<r;B++)for(var f=0;f<e;f++){for(var g=0,v=0,_=0,b=0;b<s;b++)for(var w=0;w<l;w++){var m=Math.cos(Math.PI*f*w/e)*Math.cos(Math.PI*B*b/r),M=i[w+b*l];g+=M[0]*m;v+=M[1]*m;_+=M[2]*m}var R=Blurhash._internal.utils.linearTosRGB(g),T=Blurhash._internal.utils.linearTosRGB(v),p=Blurhash._internal.utils.linearTosRGB(_);d[4*f+0+B*c]=R;d[4*f+1+B*c]=T;d[4*f+2+B*c]=p;d[4*f+3+B*c]=255}return d},pixelsToCanvas:function(a,e,r){const n=document.createElement("canvas");n.width=e;n.height=r;const t=n.getContext("2d"),s=new ImageData(a,e,r);t.putImageData(s,0,0);return n},pixelsToBase64:function(a,e,r,n,t){return Blurhash.pixelsToCanvas(a,e,r).toDataURL(t||"image/jpeg",n||1)},onPixelsToBlobSrc:function(a,e,r,n,t,s){Blurhash.pixelsToCanvas(e,r,n).toBlob((function(e){var r=document.createElement("img"),n=URL.createObjectURL(e);r.onload=function(){URL.revokeObjectURL(n)};a(n)}),s||"image/jpeg",t||1)}};
