window.ecBlurhash={imageNodes:[],imageNodesPostponed:[],loadingImages:{},decoded:{},cbOnDecode:{},addImageNode:function(e){"interactive"===document.readyState?ecBlurhash.decodeHashForImage(e):ecBlurhash.imageNodes.unshift(e)},addPostponedImageNode:function(e){ecBlurhash.imageNodesPostponed.unshift(e)},addCbOnDecode(e,a){!1===Array.isArray(ecBlurhash.cbOnDecode[e])&&(ecBlurhash.cbOnDecode[e]=[]);ecBlurhash.cbOnDecode[e].push(a)},decodeHashForImage:function(e){var a=ecBlurhash.outsourceLoadingImage(e),o=ecBlurhash.decoded[e.hash],n=ecBlurhash.onDecode(e);if(null===o||"string"==typeof o)n(o);else if(!0===o)ecBlurhash.addCbOnDecode(e.hash,n);else{ecBlurhash.decoded[e.hash]=!0;ecbUtils.decodeHashForNode(e,a,n)}},onDecode:function(e){return function(a){if(!0===ecBlurhash.decoded[e.hash]){ecBlurhash.decoded[e.hash]=a;for(var o=ecBlurhash.cbOnDecode[e.hash]||[];o.length;)o.pop()(a)}null!==a?ecBlurhash.prepareNodeForBlurhash(e,a):ecbUtils.getNodeAttribute(e.node,"data-blurhash")&&ecBlurhash.onFinalImageLoad(e).call(e.node)}},onPlaceholderImageLoad:function(e){return function(){this.setAttribute("data-ecb-p","1");this.onload=ecBlurhash.onFinalImageLoad(e);if(ecbUtils.isAncestorsVisible(e.node)&&ecbUtils.isInViewport(e.node)){ecBlurhash.addImageNode(e);ecBlurhash.outsourceLoadingImage(e)}else ecBlurhash.addPostponedImageNode(e)}},onBlurhashImageLoad:function(e){return function(){this.setAttribute("data-ecb-p","2");this.onload=ecBlurhash.onFinalImageLoad(e);this.srcset||(this.srcset=e.srcset)}},onFinalImageLoad:function(e){return function(){this.onload=null;e.node.parentElement.classList.remove("ecb-loading");e.node.style.backgroundImage=null;this.removeAttribute("data-ecb-p");this.removeAttribute("data-blurhash");this.removeAttribute("data-ow");this.removeAttribute("data-oh")}},onOriginSrcLoaded:function(e){e.node.srcset=e.srcset;e.node.src=ecbUtils.getNodeAttribute(e.node,"data-src");e.node.removeAttribute("data-srcset")},outsourceLoadingImage:function(e){var a=e.srcset;if(ecBlurhash.loadingImages.hasOwnProperty(a)){var o=ecBlurhash.loadingImages[a];o.complete?ecBlurhash.onOriginSrcLoaded(e):o.onload=ecbUtils.nestedCallback(o.onload,(function(){ecBlurhash.onOriginSrcLoaded(e)}));return o}var n=new Image;n.onload=function(){n.onload=null;ecBlurhash.onOriginSrcLoaded(e)};n.srcset=e.srcset;return ecBlurhash.loadingImages[a]=n},prepareNodeForBlurhash:function(e,a){setTimeout((function(){e.node.onload=ecBlurhash.onBlurhashImageLoad(e);e.node.src=a;e.node.parentElement.classList.add("ecb-loading")}),1)},prepareNodeForPlaceholder:function(e){setTimeout((function(){e.node.onload=ecBlurhash.onPlaceholderImageLoad(e);e.node.src=ecbUtils.placeholderBase64(e.width,e.height)}),1)},prepareNode:function(e){var a=ecbUtils.extractNode(e);a&&a.hash&&ecBlurhash.prepareNodeForPlaceholder(a)},mutationHandler:function(e){for(var a=0;a<e.length;a++)for(var o=e[a],n=0;n<o.addedNodes.length;n++){var r=o.addedNodes[n];r.nodeType===Node.ELEMENT_NODE&&"IMG"===r.tagName&&!1===r.hasAttribute("data-ecb-p")&&ecBlurhash.prepareNode(r)}},onDomInteractive:function(){for(;ecBlurhash.imageNodes.length;)ecBlurhash.decodeHashForImage(ecBlurhash.imageNodes.pop())},onDomComplete:function(){for(;ecBlurhash.imageNodesPostponed.length;)ecBlurhash.decodeHashForImage(ecBlurhash.imageNodesPostponed.pop());ecBlurhash.cleanUp()},cleanUp:function(){for(var e in ecBlurhash.loadingImages)if(ecBlurhash.loadingImages.hasOwnProperty(e)){var a=ecBlurhash.loadingImages[e];a.complete&&(a=null)}}};
